---
title: "p8105_hw5_lg3239"
author: "Landi Guo"
date: "2022-11-13"
output: github_document
editor_options: 
  chunk_output_type: inline
---

```{r}
library(tidyverse)
library(stringr)
knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

## Problem 2
```{r}
wp = read_csv("hw5_files/homicide-data.csv")
```
The raw data contains `r ncol(wp)` columns and `r nrow(wp)` rows with each row representing a homicide case. Variables include reported date, demographic identifiers for the victim, location of killing, and whether an arrest was made. The variables are `r names(wp)`. These homicides happened in `r wp%>%select(city)%>%distinct%>%count` cities in America. The victim's age ranges from `r wp%>%min(victim_age)` to `r wp%>%max(victim_age)`.

```{r}
city_total = 
  wp %>%
  mutate(city_state = str_c(city, ", ", state)) %>%
  group_by(city_state) %>%
  summarise(total_h = n()) %>%
  mutate(total_h = as.numeric(total_h))

city_unsolve = 
  wp %>%
  mutate(city_state = str_c(city, ", ", state)) %>%
  filter(disposition %in% c("Closed without arrest", "Open/No arrest")) %>%
  group_by(city_state) %>%
  summarise(unsolved_h = n()) 

missing_city = pull(city_total, city_state)[!pull(city_total, city_state) %in% pull(city_unsolve, city_state)]

city_unsolve = rbind(city_unsolve, c(missing_city, 0)) %>%
  mutate(unsolved_h = as.numeric(unsolved_h))

city_prop = full_join(city_unsolve, city_total)
city_prop
```
```{r}
baltimore_prop = prop.test(x = 1825, n = 2827)
baltimore_prop %>%
  broom::tidy() %>%
  select(estimate, conf.low, conf.high)
```

```{r}
city_test =
  city_prop %>%
  mutate(ptest = map2(.x = unsolved_h, .y = total_h, ~prop.test(x = .x, n = .y))) %>%
  mutate(ptest = map(ptest, broom::tidy)) %>%
  mutate(ptest = map(ptest, ~select(., estimate, conf.low, conf.high))) %>%
  unnest(ptest) %>%
  select(-unsolved_h, -total_h)
city_test
```

